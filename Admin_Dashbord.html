<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø¨ÙŠØª Ø§Ù„ÙƒØªØ¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Tajawal', sans-serif;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    /* Animated background particles */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/><circle cx="10" cy="60" r="0.5" fill="white" opacity="0.1"/><circle cx="90" cy="40" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
      animation: float 20s ease-in-out infinite;
      z-index: -1;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(180deg); }
    }

    /* Navbar Styling */
    .navbar {
      background: rgba(255, 255, 255, 0.95) !important;
      backdrop-filter: blur(15px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      animation: slideInDown 0.8s ease-out;
    }

    .navbar-brand {
      font-size: 1.8rem;
      font-weight: 700;
      background: linear-gradient(45deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      transition: all 0.3s ease;
    }

    .navbar-brand:hover {
      transform: scale(1.05);
    }

    .nav-link {
      font-weight: 500;
      color: #2d3748 !important;
      transition: all 0.3s ease;
      position: relative;
      padding: 10px 15px !important;
      border-radius: 8px;
      margin: 0 5px;
    }

    .nav-link::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 50%;
      width: 0;
      height: 2px;
      background: linear-gradient(45deg, #667eea, #764ba2);
      transition: all 0.3s ease;
      transform: translateX(-50%);
    }

    .nav-link:hover::after {
      width: 100%;
    }

    .nav-link:hover {
      color: #667eea !important;
      background: rgba(102, 126, 234, 0.1);
      transform: translateY(-2px);
    }

    /* Cart Icon Styling */
    .cart-icon {
      position: relative;
      font-size: 1.8rem;
      cursor: pointer;
      transition: all 0.3s ease;
      padding: 8px;
      border-radius: 50%;
      background: rgba(102, 126, 234, 0.1);
    }

    .cart-icon:hover {
      background: rgba(102, 126, 234, 0.2);
      transform: scale(1.1) rotate(5deg);
    }

    .cart-count {
      position: absolute;
      top: -5px;
      right: -5px;
      background: linear-gradient(45deg, #e53e3e, #f56565);
      color: white;
      font-size: 0.75rem;
      padding: 4px 8px;
      border-radius: 50%;
      font-weight: 600;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    /* Wishlist Icon */
    .wishlist-icon {
      position: relative;
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      padding: 8px;
      border-radius: 50%;
      background: rgba(236, 72, 153, 0.1);
      margin-left: 10px;
    }

    .wishlist-icon:hover {
      background: rgba(236, 72, 153, 0.2);
      transform: scale(1.1);
    }

    .wishlist-count {
      position: absolute;
      top: -5px;
      right: -5px;
      background: linear-gradient(45deg, #ec4899, #f472b6);
      color: white;
      font-size: 0.75rem;
      padding: 4px 8px;
      border-radius: 50%;
      font-weight: 600;
    }

    /* Logout Button */
    .btn-outline-danger {
      border: 2px solid #e53e3e;
      color: #e53e3e;
      font-weight: 600;
      transition: all 0.3s ease;
      border-radius: 25px;
      padding: 8px 20px;
    }

    .btn-outline-danger:hover {
      background: #e53e3e;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(229, 62, 62, 0.3);
    }

    /* Main Container */
    .container {
      position: relative;
      z-index: 10;
    }

    /* Filters Section */
    .filters-section {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      animation: fadeInUp 0.8s ease-out 0.2s both;
    }

    .form-select, .form-control {
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 12px 15px;
      font-weight: 500;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.8);
    }

    .form-select:focus, .form-control:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      transform: translateY(-2px);
    }

    /* Product Cards */
    .product-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      border: none;
      border-radius: 20px;
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      animation: fadeInUp 0.6s ease-out both;
      position: relative;
    }

    .product-card:hover {
      transform: translateY(-10px) scale(1.02);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    }

    .product-card img {
      height: 250px;
      object-fit: cover;
      transition: all 0.3s ease;
    }

    .product-card:hover img {
      transform: scale(1.05);
    }

    .card-body {
      padding: 25px;
    }

    .card-title {
      color: #2d3748;
      font-weight: 700;
      font-size: 1.3rem;
      margin-bottom: 15px;
      height: 3rem;
      overflow: hidden;
      display: -webkit-box;
      -webkit-box-orient: vertical;
    }

    .card-text {
      font-size: 1.4rem;
      font-weight: 700;
      background: linear-gradient(45deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .product-description {
      color: #718096;
      font-size: 0.9rem;
      margin-bottom: 15px;
      height: 3rem;
      overflow: hidden;
      display: -webkit-box;
      -webkit-box-orient: vertical;
    }

    .stock-info {
      font-size: 0.8rem;
      color: #48bb78;
      margin-bottom: 15px;
    }

    .stock-warning {
      color: #e53e3e;
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .add-to-cart {
      background: linear-gradient(45deg, #667eea, #764ba2);
      border: none;
      border-radius: 12px;
      padding: 10px 20px;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      overflow: hidden;
      flex: 1;
    }

    .add-to-cart::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .add-to-cart:hover::before {
      left: 100%;
    }

    .add-to-cart:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
    }

    .add-to-cart:active {
      transform: translateY(-1px) scale(1.02);
    }

    .wishlist-btn {
      background: linear-gradient(45deg, #ec4899, #f472b6);
      border: none;
      border-radius: 12px;
      padding: 10px;
      font-weight: 600;
      transition: all 0.3s ease;
      width: 45px;
      height: 45px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .wishlist-btn:hover {
      transform: translateY(-3px) scale(1.1);
      box-shadow: 0 10px 20px rgba(236, 72, 153, 0.3);
    }

    .wishlist-btn.active {
      background: linear-gradient(45deg, #e53e3e, #f56565);
    }

    /* Loading Animation */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 200px;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(102, 126, 234, 0.1);
      border-left-color: #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* No Products Message */
    .no-products {
      text-align: center;
      padding: 60px 20px;
      color: #718096;
      font-size: 1.2rem;
      font-weight: 500;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 20px;
      backdrop-filter: blur(10px);
    }

    /* Success Animation */
    .success-animation {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(45deg, #48bb78, #38a169);
      color: white;
      padding: 15px 25px;
      border-radius: 12px;
      font-weight: 600;
      z-index: 1000;
      animation: slideInRight 0.5s ease-out;
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Product Badges */
    .product-badges {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .badge {
      font-size: 0.7rem;
      padding: 5px 10px;
      border-radius: 15px;
    }

    .badge-new {
      background: linear-gradient(45deg, #48bb78, #38a169);
      color: white;
    }

    .badge-sale {
      background: linear-gradient(45deg, #e53e3e, #f56565);
      color: white;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .navbar-brand {
        font-size: 1.5rem;
      }
      
      .filters-section {
        padding: 20px;
      }
      
      .product-card {
        margin-bottom: 20px;
      }

      .action-buttons {
        flex-direction: column;
      }

      .wishlist-btn {
        width: 100%;
        height: auto;
        padding: 10px;
      }
    }

    /* Stagger animation for product cards */
    .col-md-4:nth-child(1) .product-card { animation-delay: 0.1s; }
    .col-md-4:nth-child(2) .product-card { animation-delay: 0.2s; }
    .col-md-4:nth-child(3) .product-card { animation-delay: 0.3s; }
    .col-md-4:nth-child(4) .product-card { animation-delay: 0.4s; }
    .col-md-4:nth-child(5) .product-card { animation-delay: 0.5s; }
    .col-md-4:nth-child(6) .product-card { animation-delay: 0.6s; }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light shadow-sm">
  <div class="container">
    <a class="navbar-brand" href="#">
      <i class="fas fa-shopping-bag me-2"></i>Ù…ØªØ¬Ø±ÙŠ
    </a>
    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarContent">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link" href="User_Product.html">
            <i class="fas fa-home me-1"></i>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" id="ordersLink">
            <i class="fas fa-shopping-bag me-1"></i>Ø·Ù„Ø¨Ø§ØªÙŠ
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">
            <i class="fas fa-phone me-1"></i>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§
          </a>
        </li>
      </ul>

      <div class="wishlist-icon" onclick="window.location.href='wishlist.html'">
        <i class="fas fa-heart"></i>
        <span class="wishlist-count" id="wishlistCount">0</span>
      </div>

      <div class="cart-icon ms-3" onclick="window.location.href='cart.html'">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-count" id="cartCount">0</span>
      </div>

      <div class="ms-4">
        <a id="logoutBtn" class="btn btn-outline-danger">
          <i class="fas fa-sign-out-alt me-1"></i>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        </a>
      </div>
    </div>
  </div>
</nav>

<div class="container my-4">
  <!-- Filters -->
  <div class="filters-section">
    <div class="row g-3">
      <div class="col-md-3">
        <select class="form-select" id="categoryFilter">
          <option value="">ğŸ·ï¸ ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
        </select>
      </div>
      <div class="col-md-3">
        <select class="form-select" id="priceFilter">
          <option value="">ğŸ’° Ø§Ù„Ø³Ø¹Ø±</option>
          <option value="0-50">0 - 50 Ø¬Ù†ÙŠÙ‡</option>
          <option value="50-100">50 - 100 Ø¬Ù†ÙŠÙ‡</option>
          <option value="100-200">100 - 200 Ø¬Ù†ÙŠÙ‡</option>
          <option value="200+">Ø£ÙƒØ«Ø± Ù…Ù† 200 Ø¬Ù†ÙŠÙ‡</option>
        </select>
      </div>
      <div class="col-md-3">
        <select class="form-select" id="sortFilter">
          <option value="">ğŸ“Š Ø§Ù„ØªØ±ØªÙŠØ¨</option>
          <option value="price-low">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø£Ø¹Ù„Ù‰</option>
          <option value="price-high">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø£Ù‚Ù„</option>
          <option value="name">Ø§Ù„Ø§Ø³Ù…: Ø£-ÙŠ</option>
          <option value="newest">Ø§Ù„Ø£Ø­Ø¯Ø«</option>
        </select>
      </div>
      <div class="col-md-3">
        <div class="input-group">
          <span class="input-group-text bg-transparent border-end-0">
            <i class="fas fa-search text-muted"></i>
          </span>
          <input type="text" id="searchInput" class="form-control border-start-0" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬...">
        </div>
      </div>
    </div>
  </div>

  <!-- Products List -->
  <div class="row" id="productsContainer">
    <!-- Loading state -->
    <div class="loading w-100">
      <div class="spinner"></div>
    </div>
  </div>
</div>

<script type="module">
  import { database } from './firebase-config.js';
  import { ref, get } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

  const productsContainer = document.getElementById('productsContainer');
  const categoryFilter = document.getElementById('categoryFilter');
  const priceFilter = document.getElementById('priceFilter');
  const sortFilter = document.getElementById('sortFilter');
  const searchInput = document.getElementById('searchInput');
  const cartCount = document.getElementById('cartCount');
  const wishlistCount = document.getElementById('wishlistCount');
  const ordersLink = document.getElementById('ordersLink');

  let allProducts = [];

  // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø±Ø¨Ø©
  function updateCartCount() {
    const cart = JSON.parse(localStorage.getItem('cart')) || {};
    cartCount.textContent = Object.keys(cart).length;
  }

  // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±ØºØ¨Ø§Øª
  function updateWishlistCount() {
    const wishlist = JSON.parse(localStorage.getItem('wishlist')) || {};
    wishlistCount.textContent = Object.keys(wishlist).length;
  }

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
  async function loadCategories() {
    const category_in_Firebase_Format = await get(ref(database, 'categories'));
    if (category_in_Firebase_Format.exists()) {
      const categories = category_in_Firebase_Format.val(); 
      console.log(categories);
      for (let id in categories) { 
        const opt = document.createElement('option');
        console.log(id);
        opt.value = id;
        opt.textContent = categories[id].name;
        categoryFilter.appendChild(opt);
      }
    }
  }

  async function loadProducts() {
    const product_fr = await get(ref(database, 'products'));
    if (product_fr.exists()) {
      const products = product_fr.val(); 
      
      allProducts = []; 
      for (let id in products) {
        allProducts.push({ id, ...products[id] });
        console.log(allProducts);
      }
      renderProducts();
    }
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
  function renderProducts() {
    productsContainer.innerHTML = '';

    let filteredProducts = allProducts;

    const selectedCategory = categoryFilter.value;
    const selectedPrice = priceFilter.value;
    const selectedSort = sortFilter.value;
    const searchTerm = searchInput.value.toLowerCase();

    // Filter by category
    if (selectedCategory) {
      filteredProducts = filteredProducts.filter(p => p.categoryId === selectedCategory);
    }

    // Filter by price
    if (selectedPrice) {
      const [min, max] = selectedPrice.split('-').map(Number);
      if (selectedPrice === '200+') {
        filteredProducts = filteredProducts.filter(p => p.price >= 200);
      } else {
        filteredProducts = filteredProducts.filter(p => p.price >= min && p.price <= max);
      }
    }

    // Filter by search
    if (searchTerm) {
      filteredProducts = filteredProducts.filter(p => 
        p.name.toLowerCase().includes(searchTerm) || 
        p.description.toLowerCase().includes(searchTerm)
      );
    }

    // Sort products
    if (selectedSort) {
      switch (selectedSort) {
        case 'price-low':
          filteredProducts.sort((a, b) => a.price - b.price);
          break;
        case 'price-high':
          filteredProducts.sort((a, b) => b.price - a.price);
          break;
        case 'name':
          filteredProducts.sort((a, b) => a.name.localeCompare(b.name));
          break;
        case 'newest':
          filteredProducts.sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));
          break;
      }
    }

    if (filteredProducts.length === 0) {
      productsContainer.innerHTML = `
        <div class="col-12">
          <div class="no-products animate__animated animate__fadeIn">
            <i class="fas fa-search fa-3x mb-3 text-muted"></i>
            <h4>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©</h4>
            <p>Ø¬Ø±Ø¨ ØªØºÙŠÙŠØ± Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø§Ù„ÙÙ„ØªØ±Ø©</p>
          </div>
        </div>
      `;
      return;
    }

    filteredProducts.forEach((product, index) => {
      const col = document.createElement('div');
      col.className = 'col-md-4 mb-4';
      col.style.animationDelay = `${index * 0.1}s`;
      
      const isInWishlist = checkWishlistStatus(product.id);
      const stockStatus = product.stockQuantity > 0 ? 'Ù…ØªÙˆÙØ±' : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
      const stockClass = product.stockQuantity > 0 ? '' : 'stock-warning';
      
      col.innerHTML = `
        <div class="card h-100 product-card animate__animated animate__fadeInUp">
          <div class="position-relative overflow-hidden">
            <img src="${product.imageURL || 'https://via.placeholder.com/300x250?text=Product'}" 
                 class="card-img-top" alt="${product.name}">
            
            <div class="product-badges">
              ${product.stockQuantity <= 5 && product.stockQuantity > 0 ? 
                '<span class="badge badge-sale">Ø¢Ø®Ø± Ù‚Ø·Ø¹Ø©</span>' : ''}
              ${new Date(product.createdAt || Date.now()).getTime() > Date.now() - 7 * 24 * 60 * 60 * 1000 ? 
                '<span class="badge badge-new">Ø¬Ø¯ÙŠØ¯</span>' : ''}
            </div>
          </div>
          
          <div class="card-body text-center d-flex flex-column">
            <h5 class="card-title">${product.name}</h5>
            <p class="product-description">${product.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù…ØªØ§Ø­'}</p>
            <p class="card-text mb-2">${product.price} Ø¬Ù†ÙŠÙ‡</p>
            <p class="stock-info ${stockClass}">
              <i class="fas fa-box me-1"></i>${stockStatus}
              ${product.stockQuantity > 0 ? `(${product.stockQuantity} Ù‚Ø·Ø¹Ø©)` : ''}
            </p>
            
            <div class="action-buttons">
              <button class="btn btn-primary add-to-cart" data-id="${product.id}" 
                      ${product.stockQuantity <= 0 ? 'disabled' : ''}>
                <i class="fas fa-cart-plus me-2"></i>Ø£Ø¶Ù Ù„Ù„Ø¹Ø±Ø¨Ø©
              </button>
              <button class="btn wishlist-btn ${isInWishlist ? 'active' : ''}" 
                      data-id="${product.id}" onclick="toggleWishlist('${product.id}')">
                <i class="fas fa-heart"></i>
              </button>
            </div>
          </div>
        </div>
      `;
      productsContainer.appendChild(col);
    });

    // Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø¹Ø±Ø¨Ø©
    document.querySelectorAll('.add-to-cart').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.dataset.id;
        const product = allProducts.find(p => p.id === id);
        
        if (product.stockQuantity <= 0) {
          showMessage('Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹', 'warning');
          return;
        }
        
        let cart = JSON.parse(localStorage.getItem('cart')) || {};
        if (cart[id]) {
          if (cart[id].quantity >= product.stockQuantity) {
            showMessage('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬', 'warning');
            return;
          }
          cart[id].quantity += 1;
        } else {
          cart[id] = { 
            name: product.name, 
            price: product.price, 
            quantity: 1,
            imageURL: product.imageURL,
            stockQuantity: product.stockQuantity
          };
        }
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
        showMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ø¹Ø±Ø¨Ø© Ø¨Ù†Ø¬Ø§Ø­! ğŸ›’', 'success');
      });
    });
  }

  // Check wishlist status
  function checkWishlistStatus(productId) {
    const wishlist = JSON.parse(localStorage.getItem('wishlist')) || {};
    return wishlist.hasOwnProperty(productId);
  }

  // Toggle wishlist
  window.toggleWishlist = function(productId) {
    const wishlist = JSON.parse(localStorage.getItem('wishlist')) || {};
    const product = allProducts.find(p => p.id === productId);
    
    if (wishlist[productId]) {
      delete wishlist[productId];
      showMessage('ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±ØºØ¨Ø§Øª', 'info');
    } else {
      wishlist[productId] = {
        name: product.name,
        price: product.price,
        imageURL: product.imageURL
      };
      showMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±ØºØ¨Ø§Øª â¤ï¸', 'success');
    }
    
    localStorage.setItem('wishlist', JSON.stringify(wishlist));
    updateWishlistCount();
    renderProducts(); // Re-render to update wishlist buttons
  };

  // Show message
  function showMessage(text, type = "success") {
    const messageDiv = document.createElement('div');
    messageDiv.className = `success-animation`;
    messageDiv.style.background = type === 'success' ? 'linear-gradient(45deg, #48bb78, #38a169)' :
                                 type === 'warning' ? 'linear-gradient(45deg, #ed8936, #f6ad55)' :
                                 type === 'info' ? 'linear-gradient(45deg, #4299e1, #63b3ed)' :
                                 'linear-gradient(45deg, #e53e3e, #f56565)';
    messageDiv.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : type === 'info' ? 'info-circle' : 'times-circle'} me-2"></i>${text}`;
    document.body.appendChild(messageDiv);
    
    setTimeout(() => {
      messageDiv.remove();
    }, 3000);
  }

  // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„Ø§ØªØ±
  categoryFilter.addEventListener('change', renderProducts);
  priceFilter.addEventListener('change', renderProducts);
  sortFilter.addEventListener('change', renderProducts);
  searchInput.addEventListener('input', renderProducts);

  // ØªØ´ØºÙŠÙ„
  updateCartCount();
  updateWishlistCount();
  loadCategories();
  loadProducts();

  // Orders link
  ordersLink.addEventListener('click', (e) => {
    e.preventDefault();
    window.location.href = 'orders.html';
  });

  import { auth } from '/firebase-config.js';
  import { signOut } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";

  const logoutBtn = document.getElementById('logoutBtn');

  logoutBtn.addEventListener('click', async () => {
    try {
      await signOut(auth);
      console.log('User logged out');
      window.location.href = './login/login.html';
    } catch (error) {
      console.error('Logout error:', error.message);
    }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>